div.content
  div.columns
    div.column.is-half
      div.field
        h3.title.is-3 {{$t('foe_data.gb.' + gb.key)}}
      div.field
        gb-list-select(v-bind:current="gb.key" v-on:change="goTo($event)")
    div.column.is-half(v-show="canPermalink")
      div.field
        nuxt-link#permalink.level-right(v-bind:to="permaLink" exact)
          span.icon
            i.fas.fa-link
          | &nbsp;{{$t('utils.permalink')}}

  h4.title.is-4 {{$t($data.i18nPrefix + 'gb_investment.title')}}

  p {{$t($data.i18nPrefix + 'gb_investment.description.p1')}}

  div.columns
    div.column.is-half
      b-field(v-bind:label="$t(i18nPrefix + 'gb_investment.form.level', { level: levelNormalized, fromLevel: levelNormalized - 1, min: 1, max: maxLevel })" label-for="giLevel" v-bind:type="haveError('level')")
        b-input#giLevel(type="number" min="1" v-bind:max="maxLevel" v-model.number="level" name="level" autocomplete="off" v-bind:autofocus="canPermalink")
    div.column.is-half
      b-field(v-bind:label="$t(i18nPrefix + 'gb_investment.form.investor_percentage')" label-for="giInvestorPercentageGlobal" v-bind:type="haveError('investorPercentageGlobal')")
        b-input#giInvestorPercentageGlobal(type="number" min="0" step="0.1" v-model.number="investorPercentageGlobal" name="investorPercentageGlobal" autocomplete="off")

  div.columns(v-if="result !== null")
    div.column.is-half
      b-field(v-bind:label="$t(i18nPrefix + 'gb_investment.form.owner_investment', { max: result.cost })" label-for="giOwnerInvestment" v-bind:type="haveError('ownerInvestment')")
        b-input#giOwnerInvestment(type="number" min="0" v-bind:max="result.cost" v-model.number="ownerInvestment" name="ownerInvestment" autocomplete="off")
    div.column.is-half
      b-field(v-bind:label="$t(i18nPrefix + 'gb_investment.form.add_investors', { min: 1, max: maxInvestment })" label-for="giAddInvestors" v-bind:type="haveError('addInvestors')")
        b-field(grouped)
          b-input#giAddInvestors(type="number" min="1" :max="maxInvestment" v-model.number="addInvestors" v-on:keyup.native.enter="addInvestor" name="addInvestors" autocomplete="off" expanded :disabled="maxInvestment <= 0" @click.native="haveReadTipAboutAddInvestor")
          p.control
            button.button.is-info(:title="$t('utils.Add')" @click="addInvestor")
              span.icon
                i.fas.fa-plus
              | &nbsp;&nbsp;{{$t('utils.Add')}}

  div.columns(v-if="(result !== null) && investorParticipation.length > 0")
    div.column
      b-field(:label="$t(i18nPrefix + 'gb_investment.form.investors_list')")
      b-field(grouped group-multiline)
        div.control(v-for="(value,index) in investorParticipation")
          b-tag(:type="isNaN(value) ? 'is-danger' : 'is-primary'" attached closable @close="removeInvestor(index)" size="is-medium") {{value}}

  div.table-wrapper(v-if="result !== null")
    table.table.is-bordered.is-striped.is-narrow.is-fullwidth.is-hidden-mobile
      thead
        tr
          th.has-text-centered(colspan=7)
            p {{$t($data.i18nPrefix + 'gb_investment.table.title', {gb_key: 'foe_data.gb.' + gb.key, level: result.level, fromLevel: (result.level - 1)})}}
        tr
          th {{$t($data.i18nPrefix + 'gb_investment.table.thead.th1')}}
          th {{$t($data.i18nPrefix + 'gb_investment.table.thead.th2')}}
          th {{$t($data.i18nPrefix + 'gb_investment.table.thead.th3')}}
          th {{$t($data.i18nPrefix + 'gb_investment.table.thead.th4')}}
          th {{$t($data.i18nPrefix + 'gb_investment.table.thead.fp_already_putin')}}
          th {{$t($data.i18nPrefix + 'gb_investment.table.thead.th5')}}
          th(width="100px") {{$t($data.i18nPrefix + 'gb_investment.table.thead.th6')}}
      tbody
        tr(v-for="(place, i) in result.investment")
          // Place
          td.has-text-right {{$formatNumber(i + 1)}}
          // Default reward
          td.has-text-right {{$formatNumber(place.reward)}}
          // Owner preparation
          td.has-text-right
            p(v-if="(place.preparation > 0) && (ownerInvestmentNormalized > 0)") {{$formatNumber(place.preparation)}} (
              template(v-if="place.preparation - ownerInvestmentNormalized > 0")
                b-tooltip(:type="$store.state.isDarkTheme ? 'is-light' : 'is-dark'" :label="$t(i18nPrefix + 'gb_investment.table.tbody.tooltip_owner_investment')" dashed)
                  span.has-text-danger {{$formatNumber(place.preparation - ownerInvestmentNormalized)}}
              template(v-else)
                span.has-text-success {{$t('utils.Secured')}}
              | )
            p(v-else) {{$formatNumber(place.preparation)}}
          // Reward with arc bonus
          td.has-text-right
            p {{$formatNumber(place.expectedParticipation)}}
          td.has-text-right
            template(v-if="place.isInvestorParticipation")
              p {{$formatNumber(place.participation)}}
            template(v-else)
              p 0
                template(v-if="place.participation > 0") &nbsp;(
                  b-tooltip(:type="$store.state.isDarkTheme ? 'is-light' : 'is-dark'" :label="$t(i18nPrefix + 'gb_investment.table.tbody.tooltip_expected_investment')" dashed) {{$formatNumber(place.participation)}}
                  | )
          // Custom arc bonus
          td
            b-field(v-bind:type="haveError('investorPercentageCustom_' + i)")
              b-input(type="number" min="0" step="0.1" v-model.number="investorPercentageCustom[i]" v-bind:name="'investorPercentageCustom_' + i" autocomplete="off")
          // Place free
          td
            b-switch(v-bind:value="placeFree[i].state" type="is-info" v-on:input="changePlaceFree(i, $event)") {{placeFree[i].state ? $t('utils.Yes') : $t('utils.No')}}

        template(v-if="result.otherInvestment.length && showExtraInvestors")
          tr(v-for="(place, i) in result.otherInvestment")
            // Place
            td.has-text-right {{$formatNumber(i + result.investment.length + 1)}}
            // Default reward
            td.has-text-right {{$formatNumber(place.reward)}}
            // Owner preparation
            td.has-text-right
              p(v-if="(place.preparation > 0) && (ownerInvestmentNormalized > 0)") {{$formatNumber(place.preparation)}} (
                template(v-if="place.preparation - ownerInvestmentNormalized > 0")
                  b-tooltip(:type="$store.state.isDarkTheme ? 'is-light' : 'is-dark'" :label="$t(i18nPrefix + 'gb_investment.table.tbody.tooltip_owner_investment')" dashed)
                    span.has-text-danger {{$formatNumber(place.preparation - ownerInvestmentNormalized)}}
                template(v-else)
                  span.has-text-success {{$t('utils.Secured')}}
                | )
              p(v-else) {{$formatNumber(place.preparation)}}
            // Reward with arc bonus
            td.has-text-right
              p {{$formatNumber(place.expectedParticipation)}}
            td.has-text-right
              template(v-if="place.isInvestorParticipation")
                p {{$formatNumber(place.participation)}}
              template(v-else)
                p 0
                  template(v-if="place.participation > 0") &nbsp;(
                    b-tooltip(:type="$store.state.isDarkTheme ? 'is-light' : 'is-dark'" :label="$t(i18nPrefix + 'gb_investment.table.tbody.tooltip_expected_investment')" dashed) {{$formatNumber(place.participation)}}
                    | )
            // Custom arc bonus
            td
            // Place free
            td

      tfoot
        tr(v-if="result.otherInvestment.length")
          th.has-text-centered(colspan=7)
            p.control.has-text-centered
              button.button.is-info(v-if="!showExtraInvestors" @click="showExtraInvestors = true")
                span.icon
                  i.fas.fa-eye
                | &nbsp;&nbsp; {{$t(i18nPrefix + 'gb_investment.table.tbody.button_show_extra_investor', { count: result.otherInvestment.length })}}

              button.button.is-info(v-else @click="showExtraInvestors = false")
                span.icon
                  i.fas.fa-eye-slash
                | &nbsp;&nbsp; {{$t(i18nPrefix + 'gb_investment.table.tbody.button_hide_extra_investor', { count: result.otherInvestment.length })}}
        tr
          th(colspan=6) {{$t($data.i18nPrefix + 'gb_investment.table.tfoot.total_preparation')}}
          td
            p.level-right {{$formatNumber(result.totalPreparations)}}
        tr
          th(colspan=6) {{$t($data.i18nPrefix + 'gb_investment.table.tfoot.level_cost')}}
          td
            p.level-right {{$formatNumber(result.cost)}}

    b-table.is-hidden-tablet.is-half-desktop.is-hidden-widescreen(:mobile-cards="true" :data="result.investment.concat(showExtraInvestors ? result.otherInvestment : [])")
      template(slot-scope="props")
        b-table-column(field="place" :label="$t(i18nPrefix + 'gb_investment.table.thead.th1')" :numeric="true")
          p {{ $formatNumber(props.index + 1) }}
        b-table-column(field="default_reward" :label="$t($data.i18nPrefix + 'gb_investment.table.thead.th2')" :numeric="true")
          p {{ $formatNumber(props.row.reward) }}
        b-table-column(field="preparation" :label="$t($data.i18nPrefix + 'gb_investment.table.thead.th3')" :numeric="true")
          p {{ $formatNumber(props.row.preparation) }}
        b-table-column(field="participation" :label="$t($data.i18nPrefix + 'gb_investment.table.thead.th4')" :numeric="true")
          p {{ $formatNumber(props.row.expectedParticipation) }}
        b-table-column(field="custom_ip" :label="$t($data.i18nPrefix + 'gb_investment.table.thead.fp_already_putin')" :numeric="true")
          template(v-if="props.row.isInvestorParticipation")
            p {{$formatNumber(props.row.participation)}}
          template(v-else)
            p 0
              template(v-if="props.row.participation > 0") &nbsp;(
                b-tooltip(position="is-left" :type="$store.state.isDarkTheme ? 'is-light' : 'is-dark'" :label="$t(i18nPrefix + 'gb_investment.table.tbody.tooltip_expected_investment')" dashed) {{$formatNumber(props.row.participation)}}
                | )
        b-table-column(v-if="props.index < result.investment.length" field="custom_ip" :label="$t($data.i18nPrefix + 'gb_investment.table.thead.th5')" :numeric="true")
          b-field(v-bind:type="haveError('investorPercentageCustom_' + props.index)")
            b-input(type="number" min="0" step="0.1" v-model.number="investorPercentageCustom[props.index]" v-bind:name="'investorPercentageCustom_' + props.index" autocomplete="off")
        b-table-column(v-if="props.index < result.investment.length" field="place_free" :label="$t($data.i18nPrefix + 'gb_investment.table.thead.th6')")
          b-switch(v-bind:value="placeFree[props.index].state" type="is-info" v-on:input="changePlaceFree(props.index, $event)") {{placeFree[props.index].state ? $t('utils.Yes') : $t('utils.No')}}

      template(slot="footer" v-if="result")
        th(colspan=3).has-text-centered
          p.control.has-text-centered
            button.button.is-info(v-if="!showExtraInvestors" @click="showExtraInvestors = true")
              span.icon
                i.fas.fa-eye
              | &nbsp;&nbsp; {{$t(i18nPrefix + 'gb_investment.table.tbody.button_show_extra_investor', { count: result.otherInvestment.length })}}

            button.button.is-info(v-else @click="showExtraInvestors = false")
              span.icon
                i.fas.fa-eye-slash
              | &nbsp;&nbsp; {{$t(i18nPrefix + 'gb_investment.table.tbody.button_hide_extra_investor', { count: result.otherInvestment.length })}}
        th {{$t($data.i18nPrefix + 'gb_investment.table.tfoot.total_preparation')}}
        td
          p.level-right {{$formatNumber(result.totalPreparations)}}
        th {{$t($data.i18nPrefix + 'gb_investment.table.tfoot.level_cost')}}
        td
          p.level-right {{$formatNumber(result.cost)}}

  h4.title.is-4.margin-top-one-em(v-if="result !== null") {{$t($data.i18nPrefix + 'promotion.title')}}

  div.columns
    div.column.is-half
      b-field(v-bind:label="$t('utils.Prefix')" label-for="giPrefix")
        b-input#giPrefix(type="text" v-model.trim="prefix" name="prefix" autocomplete="off" :placeholder="$t($data.i18nPrefix + 'promotion.prefix_placeholder')")
    div.column.is-half
      b-field(v-bind:label="$t('utils.Suffix')" label-for="giSuffix")
        b-input#giSuffix(type="text" v-model.trim="suffix" name="suffix" autocomplete="off" :placeholder="$t($data.i18nPrefix + 'promotion.suffix_placeholder')")

  div.columns
    div.column.is-half
      div.columns
        div.column.is-half
          yes-no(v-model="displayGbName" :label="$t($data.i18nPrefix + 'gb_investment.display_gb_name')")
        div.column.is-half(v-if="displayGbName")
          yes-no(v-model="shortName" :label="$t($data.i18nPrefix + 'gb_investment.use_short_name')")
    div.column.is-half
      yes-no(v-model="showLevel" :label="$t($data.i18nPrefix + 'gb_investment.show_level')")

  div(v-if="result !== null")
    b-field(v-for="(value, i) in promotion" :key="i")
      b-input(type="text" :value="value.message" readonly expanded)
      p.control
        b-tooltip(:type="$store.state.isDarkTheme ? 'is-light' : 'is-dark'" v-bind:label="$t('utils.Copyed')" :active="value.active" always)
          button.button.copy(v-clipboard="value.message" @success="successCopy(i)" v-bind:title="$t('utils.Copy')")
            span.icon
              i.far.fa-copy
            | &nbsp;&nbsp;{{$t('utils.Copy')}}
